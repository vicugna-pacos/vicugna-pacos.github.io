<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="モジュール (psm1)"><meta property="og:description" content="概要 参考：PowerShell のモジュール詳解とモジュールへのコマンドレット配置手法を考える - tech.guitarrapc.cóm 参考：PSModulePath のインストールパスを変更する - PowerShell | Microsoft Docs"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/powershell/modules/"><meta property="article:published_time" content="2021-05-10T11:36:14+09:00"><meta property="article:modified_time" content="2021-05-10T11:36:14+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="モジュール (psm1)"><meta name=twitter:description content="概要 参考：PowerShell のモジュール詳解とモジュールへのコマンドレット配置手法を考える - tech.guitarrapc.cóm 参考：PSModulePath のインストールパスを変更する - PowerShell | Microsoft Docs"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>モジュール (psm1) - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>PowerShell</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#概要>概要</a><ul><li><a href=#モジュールを読み込む>モジュールを読み込む</a></li><li><a href=#モジュールを作成する>モジュールを作成する</a></li></ul></li></ul></nav></aside></div><div class=main><article><h1>モジュール (psm1)</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-05-10 11:36:14 +0900 +0900" itemprop=datePublished>2021-05-10</time></div><div></div></div><h2 id=概要>概要</h2><p>参考：<a href=https://tech.guitarrapc.com/entry/2013/12/03/014013 target=_blank rel=noopener>PowerShell のモジュール詳解とモジュールへのコマンドレット配置手法を考える - tech.guitarrapc.cóm</a></p><p>参考：<a href="https://docs.microsoft.com/ja-jp/powershell/scripting/developer/module/modifying-the-psmodulepath-installation-path?view=powershell-5.1" target=_blank rel=noopener>PSModulePath のインストールパスを変更する - PowerShell | Microsoft Docs</a></p><h3 id=モジュールを読み込む>モジュールを読み込む</h3><p>モジュールを方法を2つ記載する。</p><p>まず1つ目は、モジュールを所定のフォルダへ置き、自動で読み込ませる方法。
フォルダパスは環境変数の <code>$env:PSModulePath</code> を参照すると分かる。大体、以下のパスが設定されているはず。</p><ul><li><code>[ドキュメントフォルダ]\WindowsPowerShell\Modules</code></li><li><code>C:\Program Files\WindowsPowerShell\Modules</code></li></ul><p>上記以外のフォルダを追加したい場合は、単純に <code>$env:PSModulePath</code> へパスを追加すると良い。ただし、この方法はセッション内でのみ有効。
永続的にフォルダを追加したい場合は、Windowsの環境変数に書き加える。</p><p>また、2つ目の方法として、個別にモジュールファイルを指定する方法もある。
ps1 ファイルのコメントを除いた先頭に、下記を追加する。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#111>using</span> <span style=color:#111>module</span> <span style=color:#d88200>&#34;.\module1.psm1&#34;</span>
</code></pre></div><p>ps1ファイルにこの記述をする場合、相対パスの基点はカレントフォルダではなくps1ファイルがある場所になる。</p><h3 id=モジュールを作成する>モジュールを作成する</h3><p><code>$env:PSModulePath</code> に psm1 を置く場合、設定したフォルダに、モジュールファイル名と同じ名前のフォルダを作成する。</p><pre><code>hoge
└ hoge.psm1
</code></pre><p>psm1 ファイルに関数を書いたら、エクスポートして外部から使えるようにする。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#111>Export-ModuleMember</span> <span style=color:#111>-Function</span> <span style=color:#111>hogeFunc</span>
</code></pre></div></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>