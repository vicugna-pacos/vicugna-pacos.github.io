<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="Visual Studio Code で開発する"><meta property="og:description" content="参考：Using Visual Studio Code for PowerShell Development - PowerShell | Microsoft Docs はじめに VS Code で PowerShell を開発する方法を記載する。 Windows には PowerShell ISE というツールがあるが、ISE がサポートするのは PowerShell v5.1 以下で、それ以降のバージョンには対応していない。 そのため、な"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/powershell/vscode/"><meta property="article:published_time" content="2021-04-23T16:03:28+09:00"><meta property="article:modified_time" content="2021-08-19T14:40:54+09:00"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>Visual Studio Code で開発する - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>PowerShell</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#拡張機能の追加>拡張機能の追加</a><ul><li><a href=#拡張機能で使う-powershell-のバージョンを指定する>拡張機能で使う PowerShell のバージョンを指定する</a></li></ul></li><li><a href=#文字コードの設定を変更>文字コードの設定を変更</a></li><li><a href=#デバッグの設定>デバッグの設定</a><ul><li><a href=#開いているスクリプトを起動するようにする>開いているスクリプトを起動するようにする</a></li><li><a href=#デバッグ時は一時的なセッションを使う>デバッグ時は一時的なセッションを使う</a></li></ul></li></ul></nav></aside></div><div class=main><article><h1>Visual Studio Code で開発する</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-04-23 16:03:28 +0900 +0900" itemprop=datePublished>2021-04-23</time>
(最終更新：<time datetime="2021-08-19 14:40:54 +0900 +0900" itemprop=dateModified>2021-08-19</time>)</div><div></div></div><p>参考：<a href=https://docs.microsoft.com/en-us/powershell/scripting/dev-cross-plat/vscode/using-vscode target=_blank rel=noopener>Using Visual Studio Code for PowerShell Development - PowerShell | Microsoft Docs</a></p><h2 id=はじめに>はじめに</h2><p>VS Code で PowerShell を開発する方法を記載する。</p><p>Windows には PowerShell ISE というツールがあるが、ISE がサポートするのは PowerShell v5.1 以下で、それ以降のバージョンには対応していない。
そのため、なるべく VS Code で開発することが推奨される。
なお、ISE はバージョンアップはしないものの、セキュリティ対策などのアップデートは続けられるとのこと。</p><p>前提条件：</p><ul><li>PC に PowerShell がインストールされている</li><li>PC に VS Code がインストールされている</li></ul><h2 id=拡張機能の追加>拡張機能の追加</h2><ol><li>VSCodeでps1ファイルを開く。</li><li>PowerShellの拡張機能をインストールするか聞かれるので、インストールする。</li></ol><p>または</p><ol><li>VS Code を起動し、<code>Ctrl</code> + <code>P</code> を押し、Quick Open を起動する。</li><li><code>ext install powershell</code> と入力し、Enter キーを押す。</li><li>サイドバーに拡張機能のビューが開く。拡張機能の一覧から、Microsoft が提供している PowerShell 拡張機能を選択し、インストールする。</li><li>インストール完了後、インストールボタンが「Reload」へ変わったら、「Reload」ボタンを押す。</li><li>VS Code の再起動が完了すれば、拡張機能のインストールが完了する。</li></ol><h3 id=拡張機能で使う-powershell-のバージョンを指定する>拡張機能で使う PowerShell のバージョンを指定する</h3><ol><li><code>Ctrl</code> + <code>Shift</code> + <code>P</code> を押し、コマンドパレットを開く。</li><li>「Session」と検索する。</li><li><code>PowerShell: Show Session Menu</code> をクリック。</li><li>使いたい PowerShell のバージョンをリストから選ぶ。</li></ol><p>上記以外にも、VS Code の画面の右下にある、緑色で PowerShell のバージョンが書かれている場所をクリックしてバージョンを選べる。</p><h2 id=文字コードの設定を変更>文字コードの設定を変更</h2><p>PowerShell ISE の既定の文字コードは UTF-8 bom付 だが、VSCodeは UTF-8。この違いが原因で日本語を出力した際などに文字化けするため、設定を変更する。</p><ol><li><code>F1</code> または <code>Ctrl</code> + <code>Shift</code> + <code>P</code> を押してコマンドパレットを表示する。</li><li><code>Configure Language Specific Settings</code> と入力、出てきたものをクリック。<br><img src=2021-04-23-16-05-58.png alt></li><li><code>PowerShell</code> を選ぶ。<br><img src=2021-04-23-16-06-20.png alt></li><li>Settings.jsonが開くので、<code>"files.encoding": "utf8bom"</code> を追記する。</li><li>Settings.jsonを保存して閉じる。</li></ol><h2 id=デバッグの設定>デバッグの設定</h2><h3 id=開いているスクリプトを起動するようにする>開いているスクリプトを起動するようにする</h3><p>エディタウィンドウで開いているファイルをデバッグするように設定する手順。</p><p>「実行」のタブを開く(<code>Ctrl</code> + <code>Shift</code> + <code>D</code>)。</p><p>「launch.jsonファイルを作成します」のリンクを押す。</p><p>「Launch Current File」を選ぶ。</p><p><img src=2021-04-23-16-07-44.png alt></p><p>launch.jsonが作成されて表示されるので、閉じる。</p><p>これで、デバッグしたいps1ファイルを開いた状態でF5を押すと、そのファイルが実行されるようになる。</p><h3 id=デバッグ時は一時的なセッションを使う>デバッグ時は一時的なセッションを使う</h3><p>VSCode でスクリプトをデバッグするときは、ターミナルに表示されている「PowerShell Integrated Console」で実行される。
このままだとずっと同じセッションが再利用されるので、例えば psm1 ファイルを編集してデバッグしても、変更後の内容が反映されなかったりする。
これを防ぐために、拡張機能の設定を変更し、デバッグ実行の度に一時的なセッションを開くようにする。</p><p>手順は下記の通り：</p><ol><li><p>Ctrl + , で設定を開く。</p></li><li><p>検索欄に「session」と入力し、カテゴリ 拡張機能 → PowerShell Configuration の中にある「PowerShell > Debugging: Create Temporary Integrated Console」のチェックボックスをオンにする。</p></li></ol><p><img src=2021-04-23-16-11-54.png alt></p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>