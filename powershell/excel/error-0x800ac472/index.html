<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="「HRESULT からの例外:0x800AC472」のエラー"><meta property="og:description" content="前提条件 Windows 10 PowerShell v5.1 Excelのバージョン：Office 365 概要 PowerShellからExcelを操作しているとき、特定の状況で下記のようなエラーが発生することがある。 &#34;0&#34; 個の引数を指定して &#34;Quit&#34; を呼び出し中に"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/powershell/excel/error-0x800ac472/"><meta property="article:published_time" content="2020-11-20T09:25:33+09:00"><meta property="article:modified_time" content="2020-11-20T09:25:33+09:00"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>「HRESULT からの例外:0x800AC472」のエラー - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>PowerShell</li><li>Excel</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#前提条件>前提条件</a></li><li><a href=#概要>概要</a></li><li><a href=#エラーの原因>エラーの原因</a></li><li><a href=#解決方法>解決方法</a></li></ul></nav></aside></div><div class=main><article><h1>「HRESULT からの例外:0x800AC472」のエラー</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2020-11-20 09:25:33 +0900 +0900" itemprop=datePublished>2020-11-20</time></div><div></div></div><h2 id=前提条件>前提条件</h2><ul><li>Windows 10</li><li>PowerShell v5.1</li><li>Excelのバージョン：Office 365</li></ul><h2 id=概要>概要</h2><p>PowerShellからExcelを操作しているとき、特定の状況で下記のようなエラーが発生することがある。</p><pre><code>&quot;0&quot; 個の引数を指定して &quot;Quit&quot; を呼び出し中に例外が発生しました: &quot;HRESULT からの例外:0x800AC472&quot;
</code></pre><p>私がこのエラーに直面したのはPowerShellをいじっていた時だが、COM経由でExcelを操作するもの (例えば .NET 系、さらには UiPath とか) でも出てくるエラーのようにみえる。</p><h2 id=エラーの原因>エラーの原因</h2><p>端的にいうと、Excelがビジー状態で要求した操作ができないときに発生するらしい。</p><p>参考：</p><ul><li><a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/9168f9f2-e5bc-4535-8d7d-4e374ab8ff09/hresult-800ac472-from-set-operations-in-excel?forum=vsto" target=_blank rel=noopener>HRESULT 800ac472 from set operations in Excel</a></li><li><a href=https://stackoverflow.com/questions/14596337/does-the-inability-of-imessagefilter-to-handle-0x800ac472-vba-e-ignore-make-im target=_blank rel=noopener>excel - Does the inability of IMessageFilter to handle 0x800AC472 (VBA_E_IGNORE) make implementing IMessageFilter irrelevant? - Stack Overflow</a></li></ul><h2 id=解決方法>解決方法</h2><p>エラーが出る処理をループで囲み、エラーが発生したらリトライする。</p><p>ただ、必ずしもエラーが出る箇所が根本原因ではないことがある。
私の場合、最初は <code>$excel.Quit()</code> でExcelを終了させるところでエラーが起きていたが、
本当の原因はブックをOneDriveで共有しているフォルダに作成していたことだった。
OneDrive の同期の処理と、Excelを開いたり編集したりする処理がぶつかっていたと思われる。
ローカルのフォルダにブックを作成するようにしたら、エラーは起きなくなった。</p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>