<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-0L8LJXJEKX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-0L8LJXJEKX');</script><meta property="og:title" content="Incoming Webhook でメッセージを送る"><meta property="og:description" content="はじめに Teams の特定のチャネルへメッセージを送る方法の一つ、Incoming Webhook の使い方を記載する。 Incoming Webhook の追加 メッセージ送信先のチャネルのコネクタを追加する。 コネクタの一覧から Incoming Webhook を探し、「構成」をクリック"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/teams/incoming-webhook/"><meta property="article:published_time" content="2021-12-09T15:42:15+09:00"><meta property="article:modified_time" content="2021-12-09T15:42:15+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Incoming Webhook でメッセージを送る"><meta name=twitter:description content="はじめに Teams の特定のチャネルへメッセージを送る方法の一つ、Incoming Webhook の使い方を記載する。 Incoming Webhook の追加 メッセージ送信先のチャネルのコネクタを追加する。 コネクタの一覧から Incoming Webhook を探し、「構成」をクリック"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>Incoming Webhook でメッセージを送る - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>Teams</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#incoming-webhook-の追加>Incoming Webhook の追加</a></li><li><a href=#メッセージを作る>メッセージを作る</a><ul><li><a href=#メッセージを送る>メッセージを送る</a></li></ul></li></ul></nav></aside></div><div class=main><article><h1>Incoming Webhook でメッセージを送る</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-12-09 15:42:15 +0900 +0900" itemprop=datePublished>2021-12-09</time></div><div></div></div><h2 id=はじめに>はじめに</h2><p>Teams の特定のチャネルへメッセージを送る方法の一つ、Incoming Webhook の使い方を記載する。</p><h2 id=incoming-webhook-の追加>Incoming Webhook の追加</h2><p>メッセージ送信先のチャネルのコネクタを追加する。</p><p><img src=2021-12-09-15-49-29.png alt></p><p>コネクタの一覧から Incoming Webhook を探し、「構成」をクリック。</p><p><img src=2021-12-09-15-50-13.png alt></p><p>送信者の名前とアイコンを設定し、「作成」をクリック。</p><p><img src=2021-12-09-15-53-54.png alt></p><p>少し待つとURLが表示されるので、コピーして保存しておく。その後、完了をクリックして画面を閉じる。</p><p><img src=2021-12-09-15-55-33.png alt></p><p>チャネルに、設定が完了したというメッセージが投稿される。</p><p><img src=2021-12-09-15-56-45.png alt></p><h2 id=メッセージを作る>メッセージを作る</h2><p>現時点では、Incoming Webhook 経由でカードを送る場合、<a href=https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference target=_blank rel=noopener>旧来のメッセージカード形式</a> のみサポートされている。
Adaptive Card はサポート外。Adaptive Card を使いたい場合は、Power Automate 経由で送るなど別の手段を使う。</p><h3 id=メッセージを送る>メッセージを送る</h3><p>PowerShell でメッセージを送るサンプルを下記に記載する。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#111>$url</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;https://xxxxx&#34;</span>  <span style=color:#75715e># Incoming Webhook の URL</span>
<span style=color:#111>$body</span> <span style=color:#111>=</span> <span style=color:#d88200>&#34;{</span><span style=color:#8045ff>`&#34;</span><span style=color:#d88200>text</span><span style=color:#8045ff>`&#34;</span><span style=color:#d88200>:</span><span style=color:#8045ff>`&#34;</span><span style=color:#d88200>testだよ</span><span style=color:#8045ff>`&#34;</span><span style=color:#d88200>}&#34;</span>
<span style=color:#75715e>#$body = Get-Content -Path &#34;C:\test\card.txt&#34; -Encoding UTF8    # テキストファイルにjsonを書いてテストする場合はこっち</span>

<span style=color:#111>$bodyByte</span> <span style=color:#111>=</span> <span style=color:#00a8c8>[Text.Encoding]</span><span style=color:#111>::</span><span style=color:#111>UTF8</span><span style=color:#111>.</span><span style=color:#111>GetBytes</span><span style=color:#111>(</span><span style=color:#111>$body</span><span style=color:#111>)</span>

<span style=color:#111>$ret</span> <span style=color:#111>=</span> <span style=color:#111>Invoke-WebRequest</span> <span style=color:#111>-Body</span> <span style=color:#111>$bodyByte</span> <span style=color:#111>-Method</span> <span style=color:#111>Post</span> <span style=color:#111>-Uri</span> <span style=color:#111>$url</span>
</code></pre></div><p>↓Teamsで受信した様子</p><p><img src=2021-12-09-16-26-36.png alt></p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>