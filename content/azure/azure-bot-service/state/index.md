---
title: "状態の管理"
date: 2020-10-02T12:04:50+09:00
weight: 3
---

## 記憶領域

ボットは、最近のWebアプリケーションと同じように、基本的にはステートレスである。
しかし、ボットは「今までどんな会話をしてきたか」を覚えなくてはいけない場合がある。

そういった情報を保存する場所は、インメモリとかDBとかどこでも良いが、
Bot Framework SDKには以下のストレージに対する実装がある:

* Memory storage - テスト用のインメモリのストレージ。ローカルでボットのテストをしたいときに使う。ボットが再起動すると消える。
* Azure Blob Storage
* Azure Cosmos DB

## State management

`State management` はボットの状態の、ストレージへの読み書きを自動化する。
状態はstate propertiesとして保持される。state propertiesとは、key-valueペアのオブジェクトで、ストレージの実態を気にせず扱えるものである。
状態のスコープには3つの種類がある。
これらすべては`bot state`クラスのサブクラスである。

* User state - ユーザーとボットの間でずっと有効なスコープ。
* Conversation state - 特定の会話で有効なスコープ。ユーザーは問わない(例えばグループ会話)
* Private conversation state - 特定の会話とユーザーで有効なスコープ。

ユーザーと会話は1つのチャンネル内でのみ認識できる。同じユーザーが異なるチャネルからボットにアクセスした場合、異なるユーザーとなる。

