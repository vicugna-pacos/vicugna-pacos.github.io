---
title: "ボットをAzureへデプロイする"
date: 2020-10-12T15:25:42+09:00
weight: 2
---

## はじめに
Azureにボットをデプロイできる環境を作る。
MSのドキュメントに掲載されている[CLIでデプロイする方法](https://docs.microsoft.com/ja-jp/azure/bot-service/bot-builder-deploy-az-cli?view=azure-bot-service-4.0&tabs=csharp)は難しそうなので、GitHubと連携してCIできる環境を作る。

前提条件：

* GitHubにボット用のリポジトリを作成して、ローカルへクローンしてある(空もしくはREADME.mdのみの状態)
* SDKの言語はC#を選択

## Azureにボットを作成する
Azureポータルで「リソースの作成」を選択し、「Web App Bot」を探して選択する。

![](2020-10-12-15-33-27.png)

ボット作成の画面になるので、必要事項を入力して「作成」を押す。

![](2020-10-12-15-40-10.png)

* ボットハンドル - ボットの名前。おそらくAzure全体で一意でなければいけない。チャンネルに接続するときなどに表示される名前。
* 価格 - F0(無料)推奨。後で変更可能。
* ボットテンプレート - Echo Bot 推奨。必要であれば別のテンプレートを選択する。
* Application Insights - オンにすると、ボットのログを記録できる。あとで日次データ量の制限をかけておくことを推奨。

作成後、しばらく待つとリソースが作成される。

## ボットのソースコードを取得する
※ ローカルで作成＆テスト済みのソースコードがあるなら、ソースコードの取得は必要ない。

作成された「Web App Bot」のリソースを選択し、「ビルド」→「ボットのソースコードをダウンロードする」をクリックする。

![](2020-10-12-16-09-46.png)

ソースコードにシークレットを含めるかどうか確認したあと、しばらく待つとzipファイルがダウンロードできる。
zipファイルを解凍した後、あらかじめクローンしておいたGitHubリポジトリへコピーする。
その後、ソースコードは全てコミット＆プッシュしておく。

## CIを設定する
Azureポータルにて、ボット作成時に一緒に作成された App Service の方のリソースを選択し、「デプロイ センター」をクリックする。

![](2020-10-12-16-20-13.png)

Azure と GitHub の連携が初めての場合、GitHubにログインしてAzureのアクセスを許可する手順がある。

それが完了した後、ビルドプロバイダーを選択するページになるので「GitHub Actions」を選択する。

次に構成を選択するページになるので、下記の通り選択する：

* 組織 - GitHubの組織、またはアカウントを選択する。
* リポジトリ - ボットのソースコードをコミットしたリポジトリを選択する。
* ブランチ - CIの対象になるブランチを指定。通常、mainになるかと思う。
* ランタイムスタック - アプリの言語を指定。今回は「.NET Core」を選択。
* バージョン - ソースコードのプロジェクトのプロパティを確認して、選択する。

![](2020-10-12-16-28-45.png)

最後に確認画面になるので、内容を確認して確定する。

確定後、GitHub側にデプロイ実行用のファイルが追加され、Actionが実行される。

![](2020-10-12-16-32-14.png)
