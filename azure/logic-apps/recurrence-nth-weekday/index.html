<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="毎月第2金曜日だけフローを実行する"><meta property="og:description" content="はじめに Power Automate のフローを、毎月第2金曜日、のように「第n●曜日」だけ実行したい場合のサンプル。 スケジュール済みクラウドフローを作成 新しいフローを作成するときに、「スケジュール済みクラウドフロー」を選ぶ。"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/azure/logic-apps/recurrence-nth-weekday/"><meta property="article:published_time" content="2022-03-11T09:16:30+09:00"><meta property="article:modified_time" content="2022-03-11T09:16:30+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="毎月第2金曜日だけフローを実行する"><meta name=twitter:description content="はじめに Power Automate のフローを、毎月第2金曜日、のように「第n●曜日」だけ実行したい場合のサンプル。 スケジュール済みクラウドフローを作成 新しいフローを作成するときに、「スケジュール済みクラウドフロー」を選ぶ。"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>毎月第2金曜日だけフローを実行する - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>Azure</li><li>Azure Logic Apps (Power Automateも含む)</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#スケジュール済みクラウドフローを作成>スケジュール済みクラウドフローを作成</a></li><li><a href=#第2金曜日かチェック>第2金曜日かチェック</a><ul><li><a href=#現在日付を取得>現在日付を取得</a></li><li><a href=#日付で分岐>日付で分岐</a></li></ul></li><li><a href=#分岐の後にフローを続ける>分岐の後にフローを続ける</a></li><li><a href=#応用-日付の考え方>応用 (日付の考え方)</a></li></ul></nav></aside></div><div class=main><article><h1>毎月第2金曜日だけフローを実行する</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2022-03-11 09:16:30 +0900 +0900" itemprop=datePublished>2022-03-11</time></div><div></div></div><h2 id=はじめに>はじめに</h2><p>Power Automate のフローを、毎月第2金曜日、のように「第n●曜日」だけ実行したい場合のサンプル。</p><h2 id=スケジュール済みクラウドフローを作成>スケジュール済みクラウドフローを作成</h2><p>新しいフローを作成するときに、「スケジュール済みクラウドフロー」を選ぶ。</p><p><img src=2022-03-11-09-22-16.png alt></p><p>※ 手動でトリガーを追加する場合は、「Recurrence」を選ぶ。</p><p>「スケジュール済みクラウドフロー」を選んだ場合は、フロー名と同時にフローを実行するスケジュールを指定する。ここでは「第2金曜日のAM8:00」に実行すると仮定して、以下のように指定した。</p><p><img src=2022-03-11-09-30-52.png alt></p><p>まだ設定が必要な項目があるので、ひとまずこれでフローを作成する。フローの編集画面になったら、Recurrence の詳細を表示する。</p><p>以下3つの項目が空白なので、それぞれ値を指定する。</p><p><img src=2022-03-11-09-45-58.png alt></p><ul><li>タイムゾーン ： 日本時間に合わせたい場合は、「(UTC+09:00) 大阪、札幌、東京」を選ぶ。</li><li>設定時刻 (時間) ：「8」を選ぶ。</li><li>設定時刻 (分) ： 「0」を入力。</li></ul><p>特にタイムゾーンの指定が空白のままだと、日本時間の金曜日AM8:00にフローが実行されない (土曜日のAM8:00に実行される)。
開始時刻をUTCにして日本時間のAM8:00にしているが、これではだめらしい。</p><h2 id=第2金曜日かチェック>第2金曜日かチェック</h2><h3 id=現在日付を取得>現在日付を取得</h3><p>まず、「現在の時刻」と「タイムゾーンの変換」を置き、現在日付の日の部分を取り出す。</p><p>フローは下記の通り。</p><p><img src=2022-03-11-10-06-21.png alt></p><ul><li>書式設定文字列 ： カスタム値の入力から「dd」を入力。</li><li>変換元のタイムゾーン ： (UTC) 協定世界時</li><li>変換先のタイムゾーン ： (UTC+09:00) 大阪、札幌、東京</li></ul><h3 id=日付で分岐>日付で分岐</h3><p>次に分岐を使い、日付が8～14の間ではない場合にフローを終了させる。</p><p><img src=2022-03-11-10-11-33.png alt></p><p>分岐の左辺は <code>int(body('タイム_ゾーンの変換'))</code> として、日付を数値に変換している。</p><p>「終了」のアクションでは、「状態」を「成功」にしておく。状態が「失敗」のままだとフローがエラーで終了したことになってしまうので、本当にエラーだった時と区別が付きづらくなるのでお勧めしない。</p><p><img src=2022-03-11-10-14-01.png alt></p><h2 id=分岐の後にフローを続ける>分岐の後にフローを続ける</h2><p>あとは、第2金曜日にやりたいことを、分岐の後に足していけばよい。</p><p><img src=2022-03-11-10-18-55.png alt></p><h2 id=応用-日付の考え方>応用 (日付の考え方)</h2><p>月の1日目が何曜日で始まっても、第2●曜日は必ず 8日～14日の間になる。そのため、毎週金曜日にフローを起動し、日付が8～14の間のときだけフローを続けている。</p><p>同じように、第1●曜日、第3●曜日は下記のようになる。</p><ul><li>第1●曜日 ： 1日～7日</li><li>第2●曜日 ： 8日～14日</li><li>第3●曜日 ： 15日～21日</li><li>第4●曜日 ： 22日～28日</li><li>第5●曜日 ： 29日～31日</li></ul></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>