<!doctype html><html><head><meta name=generator content="Hugo 0.74.1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>状態の管理 - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#記憶領域>記憶領域</a></li><li><a href=#state-management>State management</a></li><li><a href=#サンプル>サンプル</a></li></ul></nav></aside></div><div class=main><article><h1>状態の管理</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2020-10-02 12:04:50 +0900 +0900" itemprop=datePublished>2020-10-02</time></div><div></div></div><h2 id=記憶領域>記憶領域</h2><p>ボットは、最近のWebアプリケーションと同じように、基本的にはステートレスである。
しかし、ボットは「今までどんな会話をしてきたか」を覚えなくてはいけない場合がある。</p><p>そういった情報を保存する場所は、インメモリとかDBとかどこでも良いが、
Bot Framework SDKには以下のストレージに対する実装がある:</p><ul><li>Memory storage - テスト用のインメモリのストレージ。ローカルでボットのテストをしたいときに使う。ボットが再起動すると消える。</li><li>Azure Blob Storage</li><li>Azure Cosmos DB</li></ul><h2 id=state-management>State management</h2><p><code>State management</code> はボットの状態の、ストレージへの読み書きを自動化する。
状態はstate propertiesとして保持される。state propertiesとは、key-valueペアのオブジェクトで、ストレージの実態を気にせず扱えるものである。
状態のスコープには3つの種類がある。
これらすべては<code>bot state</code>クラスのサブクラスである。</p><ul><li>User state - ユーザーとボットの間でずっと有効なスコープ。</li><li>Conversation state - 特定の会話で有効なスコープ。ユーザーは問わない(例えばグループ会話)</li><li>Private conversation state - 特定の会話とユーザーで有効なスコープ。</li></ul><p>ユーザーと会話は1つのチャンネル内でのみ認識できる。同じユーザーが異なるチャネルからボットにアクセスした場合、異なるユーザーとなる。</p><h2 id=サンプル>サンプル</h2><p>参考：<a href="https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-howto-v4-state?view=azure-bot-service-4.0&tabs=csharp" target=_blank rel=noopener>Save user and conversation data - Bot Service | Microsoft Docs</a></p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>