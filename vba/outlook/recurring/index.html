<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="繰り返しの予定"><meta property="og:description" content="概要 Outlook の予定またはタスクで設定できる「繰り返し」について。 参照：RecurrencePattern object (Outlook) | Microsoft Docs AppointmentItem または TaskItem で設定できる。 上記2つには IsRecurring(Boolean) プロパティがあり、まずこれで繰り返しのアイテムかどうか"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/vba/outlook/recurring/"><meta property="article:published_time" content="2021-10-13T16:22:59+09:00"><meta property="article:modified_time" content="2021-10-13T16:22:59+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="繰り返しの予定"><meta name=twitter:description content="概要 Outlook の予定またはタスクで設定できる「繰り返し」について。 参照：RecurrencePattern object (Outlook) | Microsoft Docs AppointmentItem または TaskItem で設定できる。 上記2つには IsRecurring(Boolean) プロパティがあり、まずこれで繰り返しのアイテムかどうか"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>繰り返しの予定 - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>VBA</li><li>Outlook VBA</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#概要>概要</a></li><li><a href=#繰り返しの予定の作り方>繰り返しの予定の作り方</a></li><li><a href=#繰り返しの予定の取得>繰り返しの予定の取得</a><ul><li><a href=#日付を指定して繰り返しの予定を取得>日付を指定して繰り返しの予定を取得</a></li></ul></li></ul></nav></aside></div><div class=main><article><h1>繰り返しの予定</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-10-13 16:22:59 +0900 +0900" itemprop=datePublished>2021-10-13</time></div><div></div></div><h2 id=概要>概要</h2><p>Outlook の予定またはタスクで設定できる「繰り返し」について。</p><p><img src=2021-10-13-16-26-02.png alt></p><p>参照：<a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.recurrencepattern target=_blank rel=noopener>RecurrencePattern object (Outlook) | Microsoft Docs</a></p><p>AppointmentItem または TaskItem で設定できる。
上記2つには IsRecurring(Boolean) プロパティがあり、まずこれで繰り返しのアイテムかどうか確認できる。
繰り返しの詳細は、GetRecurrencePattern メソッドで取得できる。
GetRecurrencePattern または ClearRecurrencePattern メソッドを呼び出すと、IsRecurring プロパティが自動的に変更される。
つまり、何も気にせず GetRecurrencePattern を呼び出すと、IsRecurring が勝手に true になるので注意。</p><h2 id=繰り返しの予定の作り方>繰り返しの予定の作り方</h2><p>AppointmentItem の GetRecurrencePattern メソッドを呼び出し、繰り返しの設定をする。</p><p>参照： <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.recurrencepattern target=_blank rel=noopener>RecurrencePattern object (Outlook) | Microsoft Docs</a></p><p>下記は、現在日時に予定を作成し、2日ごとに3回繰り返しの設定をするサンプル。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#00a8c8>Public</span> <span style=color:#00a8c8>Sub</span> <span style=color:#75af00>Sample</span><span style=color:#111>()</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oItem</span> <span style=color:#f92672>As</span> <span style=color:#111>AppointmentItem</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>dStart</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>Date</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>dEnd</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>Date</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>recurPattern</span> <span style=color:#f92672>As</span> <span style=color:#111>RecurrencePattern</span>
    
    
    <span style=color:#111>dStart</span> <span style=color:#f92672>=</span> <span style=color:#111>Now</span>
    <span style=color:#111>dEnd</span> <span style=color:#f92672>=</span> <span style=color:#111>DateAdd</span><span style=color:#111>(</span><span style=color:#d88200>&#34;h&#34;</span><span style=color:#111>,</span> <span style=color:#111>1</span><span style=color:#111>,</span> <span style=color:#111>dStart</span><span style=color:#111>)</span>
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oItem</span> <span style=color:#f92672>=</span> <span style=color:#111>Application</span><span style=color:#111>.</span><span style=color:#111>CreateItem</span><span style=color:#111>(</span><span style=color:#111>olAppointmentItem</span><span style=color:#111>)</span>
    <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>Subject</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;繰り返しテスト&#34;</span>
    <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>Start</span> <span style=color:#f92672>=</span> <span style=color:#111>dStart</span>
    <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>End</span> <span style=color:#f92672>=</span> <span style=color:#111>dEnd</span>
    <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>ReminderSet</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>False</span>
    
    <span style=color:#75715e>&#39; 2日ごとに3回繰り返す
</span><span style=color:#75715e></span>    <span style=color:#00a8c8>Set</span> <span style=color:#111>recurPattern</span> <span style=color:#f92672>=</span> <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>GetRecurrencePattern</span>
    <span style=color:#111>recurPattern</span><span style=color:#111>.</span><span style=color:#111>RecurrenceType</span> <span style=color:#f92672>=</span> <span style=color:#111>olRecursDaily</span>
    <span style=color:#111>recurPattern</span><span style=color:#111>.</span><span style=color:#111>Interval</span> <span style=color:#f92672>=</span> <span style=color:#111>2</span>
    <span style=color:#111>recurPattern</span><span style=color:#111>.</span><span style=color:#111>Duration</span> <span style=color:#f92672>=</span> <span style=color:#111>3</span>
    
    <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>Save</span>
    
<span style=color:#00a8c8>End</span> <span style=color:#00a8c8>Sub</span>
</code></pre></div><h2 id=繰り返しの予定の取得>繰り返しの予定の取得</h2><p>検索 (Filter や Restrict) を使う場合は、通常の予定の検索と手順は同じ。</p><p>検索の手順は下記の通り：</p><ol><li>Items を Start の昇順で並べ替える。</li><li>IncludeRecurrences プロパティを true にする。<ol><li>Items に終了日のない繰り返しの予定があるときに IncludeRecurrences をtrueにすると、Items.Count の値がundefinedになるので注意。</li></ol></li><li>Filter や Restrict を使う。</li></ol><p>参考：<a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.items.includerecurrences target=_blank rel=noopener>Items.IncludeRecurrences property (Outlook) | Microsoft Docs</a></p><h3 id=日付を指定して繰り返しの予定を取得>日付を指定して繰り返しの予定を取得</h3><p><code>AppointmentItem.RecurrencePattern().GetOccurrence(DateTime)</code> メソッドを使うと、
繰り返しの予定のうち、指定した日付の <code>AppointmentItem</code> を取得できる。
指定した日に予定がない場合はエラーになる。</p><pre><code>実行時エラー -2147467259 (80004005)

この定期的なアイテムの 1 回分に変更を加えたので、この回はもう存在しません。開いているアイテムをすべて閉じて、再度実行してください。
</code></pre><p>引数に指定する日付は、<strong>予定の開始時刻と同時刻でなければいけない</strong> 。開始時刻が12:00なら、単純に「2020/10/08」と日付だけ指定している下記のサンプルではエラーになる。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#111>dt</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;2020/10/08&#34;</span>
<span style=color:#111>oItem2</span> <span style=color:#f92672>=</span> <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>GetRecurrencePattern</span><span style=color:#111>().</span><span style=color:#111>GetOccurrence</span><span style=color:#111>(</span><span style=color:#111>dt</span><span style=color:#111>)</span>
</code></pre></div><p>時刻もしていすればエラーにならない。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#111>dt</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;2020/10/08 12:00&#34;</span>
<span style=color:#111>oItem2</span> <span style=color:#f92672>=</span> <span style=color:#111>oItem</span><span style=color:#111>.</span><span style=color:#111>GetRecurrencePattern</span><span style=color:#111>().</span><span style=color:#111>GetOccurrence</span><span style=color:#111>(</span><span style=color:#111>dt</span><span style=color:#111>)</span>
</code></pre></div><p>参考：<a href=https://stackoverflow.com/questions/12167921/getoccurrence-always-throws-exception target=_blank rel=noopener>vb.net - GetOccurrence always throws exception - Stack Overflow</a></p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>