<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="Outlook VBA 開発の始め方"><meta property="og:description" content="はじめに Outlook VBA の始め方を記載する。 PC にインストール済みの Outlook に付随している Visual Basic for Applications を使ったマクロ開発を目指す。 Office のバージョンは 365 。 開発タブを表示する 既定では Outlook のリボンに「開発」タブが表示されていないので、"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/vba/outlook/get-started/"><meta property="article:published_time" content="2021-08-27T16:41:31+09:00"><meta property="article:modified_time" content="2021-11-08T15:31:32+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Outlook VBA 開発の始め方"><meta name=twitter:description content="はじめに Outlook VBA の始め方を記載する。 PC にインストール済みの Outlook に付随している Visual Basic for Applications を使ったマクロ開発を目指す。 Office のバージョンは 365 。 開発タブを表示する 既定では Outlook のリボンに「開発」タブが表示されていないので、"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>Outlook VBA 開発の始め方 - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>VBA</li><li>Outlook VBA</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#開発タブを表示する>開発タブを表示する</a></li><li><a href=#マクロの実行を許可する>マクロの実行を許可する</a></li><li><a href=#エディタを開く>エディタを開く</a></li><li><a href=#プロジェクトとは>プロジェクトとは</a></li><li><a href=#受信トレイや予定表を取得する>受信トレイや予定表を取得する</a></li><li><a href=#メールや予定を取得する>メールや予定を取得する</a></li><li><a href=#特定のフォルダを取得>特定のフォルダを取得</a></li></ul></nav></aside></div><div class=main><article><h1>Outlook VBA 開発の始め方</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-08-27 16:41:31 +0900 +0900" itemprop=datePublished>2021-08-27</time>
(最終更新：<time datetime="2021-11-08 15:31:32 +0900 +0900" itemprop=dateModified>2021-11-08</time>)</div><div></div></div><h2 id=はじめに>はじめに</h2><p>Outlook VBA の始め方を記載する。
PC にインストール済みの Outlook に付随している Visual Basic for Applications を使ったマクロ開発を目指す。</p><p>Office のバージョンは 365 。</p><h2 id=開発タブを表示する>開発タブを表示する</h2><p>既定では Outlook のリボンに「開発」タブが表示されていないので、設定を変更する。</p><ol><li>ファイル → オプション → リボンのユーザー設定 をクリック。</li><li>右側のリストにある「開発」にチェックを入れ、OKボタンをクリック。</li><li>リボンに「開発」タブが表示される。</li></ol><h2 id=マクロの実行を許可する>マクロの実行を許可する</h2><p>既定では自作のマクロが実行されないので、設定を変更する。</p><ol><li>「開発」タブ → マクロのセキュリティ をクリック。</li><li>「マクロの設定」欄にある選択肢で、下記のいずれかを選択してOKボタンをクリック。<ul><li>すべてのマクロに対して警告を表示する</li><li>すべてのマクロを有効にする</li></ul></li><li>Outlook を再起動する</li></ol><p>「すべてのマクロに対して警告を表示する」にすると、マクロを実行するたびに警告が表示され、実行するかどうか選ぶ必要がある。それが煩わしいのであれば、リスクを検討したうえで「すべてのマクロを有効にする」を選ぶと良いと思われる。</p><h2 id=エディタを開く>エディタを開く</h2><ol><li>「開発」タブ → Visual Basic をクリック。</li><li>セキュリティの警告が表示されたら、「マクロを有効にする」をクリック。</li><li>Visual Basic for Applications が起動する。</li></ol><h2 id=プロジェクトとは>プロジェクトとは</h2><p>エディタの左側を見ると、オブジェクトやモジュールは「Project1」の中に作られるように見える。</p><p><img src=2021-08-31-13-32-29.png alt></p><p>この「プロジェクト」は既定で作成され、1ユーザーごとに1つだけ使える。同時に複数プロジェクトを作ったり実行したりはできない。「VbaProject.OTM」はユーザーフォルダに保存されている (Windows 10 の PC で調べてみたところ、<code>%APPDATA%\Microsoft\Outlook</code> に保存されていた) 。</p><p>別のプロジェクトファイルを実行したい場合は、下記の手順が必要。</p><ol><li>Outlook を終了させる。</li><li>現在の VbaProject.OTM を別の名前へ変更する。</li><li>実行したい方のプロジェクトファイルの名前を、VbaProject.OTM へ変更する。</li><li>Outlook を起動する。</li></ol><p>VBA は個人が自分で作って使うことを前提としているため、他の人へ配布するのには向いていない。もしマクロを他の PC に共有したい場合は、フォームやモジュールを1つずつエクスポート＆インポートするとよい。</p><p>複数名へ配布するようなものを開発したい場合は、VBA ではなく Outlook COM Add-in を使うことを検討するとよい。</p><p>参考：<a href=https://docs.microsoft.com/en-us/office/vba/outlook/concepts/getting-started/using-visual-basic-for-applications-in-outlook target=_blank rel=noopener>Using Visual Basic for Applications in Outlook | Microsoft Docs</a></p><h2 id=受信トレイや予定表を取得する>受信トレイや予定表を取得する</h2><p>受信したメールに何らかの操作をする場合、まず受信トレイなどのフォルダを取得するところから始める。
下記のサンプルでは、受信トレイを取得した後、受信トレイ内の1件目のメールの件名をダイアログで表示する。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#00a8c8>Public</span> <span style=color:#00a8c8>Sub</span> <span style=color:#75af00>test1</span><span style=color:#111>()</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oNs</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>NameSpace</span>
    <span style=color:#111>Dim</span> <span style=color:#111>oFolder</span> <span style=color:#f92672>As</span> <span style=color:#111>Folder</span>
    
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oNs</span> <span style=color:#f92672>=</span> <span style=color:#111>Application</span><span style=color:#111>.</span><span style=color:#111>GetNamespace</span><span style=color:#111>(</span><span style=color:#d88200>&#34;MAPI&#34;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oFolder</span> <span style=color:#f92672>=</span> <span style=color:#111>oNs</span><span style=color:#111>.</span><span style=color:#111>GetDefaultFolder</span><span style=color:#111>(</span><span style=color:#111>olFolderInbox</span><span style=color:#111>)</span>
    
    <span style=color:#00a8c8>If</span> <span style=color:#111>oFolder</span><span style=color:#111>.</span><span style=color:#111>Items</span><span style=color:#111>.</span><span style=color:#111>Count</span> <span style=color:#f92672>=</span> <span style=color:#111>0</span> <span style=color:#00a8c8>Then</span>
        <span style=color:#00a8c8>Exit</span> <span style=color:#00a8c8>Sub</span>
    <span style=color:#75af00>End</span> <span style=color:#00a8c8>If</span>
    
    <span style=color:#111>MsgBox</span> <span style=color:#111>oFolder</span><span style=color:#111>.</span><span style=color:#111>Items</span><span style=color:#111>(</span><span style=color:#111>1</span><span style=color:#111>).</span><span style=color:#111>Subject</span>
    
<span style=color:#00a8c8>End</span> <span style=color:#00a8c8>Sub</span>
</code></pre></div><p><code>oNs.GetDefaultFolder(olFolderInbox)</code> の部分で受信トレイを取得している。
GetDefaultFolder メソッドで取得できる既定のフォルダは他にもあり、予定表やTodoのフォルダも取得できる。
詳しくは <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.namespace.getdefaultfolder target=_blank rel=noopener>GetDefaultFolder メソッドのドキュメント</a> と <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.oldefaultfolders target=_blank rel=noopener>OlDefaultFolders 列挙体のドキュメント</a> を参照。</p><h2 id=メールや予定を取得する>メールや予定を取得する</h2><p>受信トレイや予定表を Folder オブジェクトで取得した後、そのフォルダ内にあるメールや予定は Folder.Items で取得できる。
Items の各要素は、種類によって型が違う。</p><ul><li>メール - <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.mailitem target=_blank rel=noopener>MailItem</a></li><li>予定 - <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.appointmentitem target=_blank rel=noopener>AppointmentItem</a></li><li>会議の招待 - <a href=https://docs.microsoft.com/en-us/office/vba/api/outlook.meetingitem target=_blank rel=noopener>MeetingItem</a></li><li>その他いろいろ</li></ul><p>受信トレイなどのメールのフォルダに届くのは MailItem に限らない。他人から送られてきた会議の招待と、自分が作った会議の返答は MeetingItem になる。</p><p>↓会議の招待の例<br><img src=2021-10-13-10-52-49.png alt></p><p>なので、メールフォルダの Item を取得するときは Item の型を MailItem に限定するよりは、Variant 型にしておいた方が無難かもしれない。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#75715e>&#39; 「削除済みアイテム」にある「承諾済み」の連絡を漁って、Item の型を出力している
</span><span style=color:#75715e></span><span style=color:#00a8c8>Public</span> <span style=color:#00a8c8>Sub</span> <span style=color:#75af00>test1</span><span style=color:#111>()</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oNs</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>NameSpace</span>
    <span style=color:#111>Dim</span> <span style=color:#111>oFolder</span> <span style=color:#f92672>As</span> <span style=color:#111>Folder</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>filter</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>String</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oItems</span> <span style=color:#f92672>As</span> <span style=color:#111>Items</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oItem</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>Variant</span>  <span style=color:#75715e>&#39; ここを Variant にしておく
</span><span style=color:#75715e></span>    
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oNs</span> <span style=color:#f92672>=</span> <span style=color:#111>Application</span><span style=color:#111>.</span><span style=color:#111>GetNamespace</span><span style=color:#111>(</span><span style=color:#d88200>&#34;MAPI&#34;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oFolder</span> <span style=color:#f92672>=</span> <span style=color:#111>oNs</span><span style=color:#111>.</span><span style=color:#111>GetDefaultFolder</span><span style=color:#111>(</span><span style=color:#111>olFolderDeletedItems</span><span style=color:#111>)</span>
    
    <span style=color:#111>filter</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;@SQL=&#34;&#34;urn:schemas:httpmail:subject&#34;&#34; like &#39;Accepted:%&#39;&#34;</span>
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oItems</span> <span style=color:#f92672>=</span> <span style=color:#111>oFolder</span><span style=color:#111>.</span><span style=color:#111>Items</span><span style=color:#111>.</span><span style=color:#111>Restrict</span><span style=color:#111>(</span><span style=color:#111>filter</span><span style=color:#111>)</span>
    
    <span style=color:#00a8c8>For</span> <span style=color:#00a8c8>Each</span> <span style=color:#111>oItem</span> <span style=color:#f92672>In</span> <span style=color:#111>oItems</span>
        <span style=color:#111>Debug</span><span style=color:#111>.</span><span style=color:#111>Print</span> <span style=color:#111>TypeName</span><span style=color:#111>(</span><span style=color:#111>oItem</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>Next</span>
    
<span style=color:#00a8c8>End</span> <span style=color:#00a8c8>Sub</span>
</code></pre></div><h2 id=特定のフォルダを取得>特定のフォルダを取得</h2><p>受信トレイの中に作ったフォルダや、自分にアクセス権がある共有アカウントのフォルダを取得できる。</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vb data-lang=vb><span style=color:#75715e>&#39; ----------------------------------------
</span><span style=color:#75715e>&#39; aaa@example.com\受信トレイ\テストフォルダ　など\区切りで指定したフォルダを取得する
</span><span style=color:#75715e>&#39; ----------------------------------------
</span><span style=color:#75715e></span><span style=color:#00a8c8>Private</span> <span style=color:#00a8c8>Function</span> <span style=color:#75af00>GetFolder</span><span style=color:#111>(</span><span style=color:#00a8c8>ByRef</span> <span style=color:#111>oNs</span> <span style=color:#f92672>As</span> <span style=color:#111>NameSpace</span><span style=color:#111>,</span> <span style=color:#111>folderName</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>String</span><span style=color:#111>)</span> <span style=color:#f92672>As</span> <span style=color:#111>Folder</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>names</span><span style=color:#111>()</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>String</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>idx1</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>Integer</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>idx2</span> <span style=color:#f92672>As</span> <span style=color:#00a8c8>Integer</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oFolders</span> <span style=color:#f92672>As</span> <span style=color:#111>Folders</span>
    <span style=color:#00a8c8>Dim</span> <span style=color:#111>oResult</span> <span style=color:#f92672>As</span> <span style=color:#111>Folder</span>
    
    
    <span style=color:#111>names</span> <span style=color:#f92672>=</span> <span style=color:#111>Split</span><span style=color:#111>(</span><span style=color:#111>folderName</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;\&#34;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oFolders</span> <span style=color:#f92672>=</span> <span style=color:#111>oNs</span><span style=color:#111>.</span><span style=color:#111>Folders</span>
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oResult</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Nothing</span>

    <span style=color:#00a8c8>For</span> <span style=color:#111>idx1</span> <span style=color:#f92672>=</span> <span style=color:#111>0</span> <span style=color:#00a8c8>To</span> <span style=color:#111>UBound</span><span style=color:#111>(</span><span style=color:#111>names</span><span style=color:#111>)</span>
        <span style=color:#00a8c8>Set</span> <span style=color:#111>oResult</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Nothing</span>
        
        <span style=color:#00a8c8>For</span> <span style=color:#111>idx2</span> <span style=color:#f92672>=</span> <span style=color:#111>1</span> <span style=color:#00a8c8>To</span> <span style=color:#111>oFolders</span><span style=color:#111>.</span><span style=color:#111>Count</span>
            <span style=color:#00a8c8>If</span> <span style=color:#111>oFolders</span><span style=color:#111>(</span><span style=color:#111>idx2</span><span style=color:#111>).</span><span style=color:#111>Name</span> <span style=color:#f92672>=</span> <span style=color:#111>names</span><span style=color:#111>(</span><span style=color:#111>idx1</span><span style=color:#111>)</span> <span style=color:#00a8c8>Then</span>
                <span style=color:#00a8c8>Set</span> <span style=color:#111>oResult</span> <span style=color:#f92672>=</span> <span style=color:#111>oFolders</span><span style=color:#111>(</span><span style=color:#111>idx2</span><span style=color:#111>)</span>
                <span style=color:#00a8c8>Set</span> <span style=color:#111>oFolders</span> <span style=color:#f92672>=</span> <span style=color:#111>oFolders</span><span style=color:#111>(</span><span style=color:#111>idx2</span><span style=color:#111>).</span><span style=color:#111>Folders</span>
                <span style=color:#00a8c8>Exit</span> <span style=color:#00a8c8>For</span>
            <span style=color:#00a8c8>End</span> <span style=color:#00a8c8>If</span>
        <span style=color:#00a8c8>Next</span>
    <span style=color:#00a8c8>Next</span>
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>GetFolder</span> <span style=color:#f92672>=</span> <span style=color:#111>oResult</span>
    
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oResult</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Nothing</span>
    <span style=color:#00a8c8>Set</span> <span style=color:#111>oFolders</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Nothing</span>
<span style=color:#00a8c8>End</span> <span style=color:#00a8c8>Function</span>
</code></pre></div><p>共有メールボックスのフォルダを指定する場合、フォルダ名はメールアドレスではなく、Outlook の左側の画面に表示されている名前を指定する。</p><p><img src=2021-11-08-15-25-37.png alt></p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>