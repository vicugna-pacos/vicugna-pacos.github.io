<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143399608-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-143399608-2');</script><meta property="og:title" content="管理しやすい集計表の作り方"><meta property="og:description" content="はじめに Excel で集計表を作る時に、管理しやすい作り方を記載する。 今回は例として、従業員の残業時間の一覧表を挙げる。 この表に直接残業時間などを入力しても良いが、Excelのデータは「入力用」「集計用」「表示"><meta property="og:type" content="article"><meta property="og:url" content="https://vicugna-pacos.github.io/excel/basics-data/"><meta property="article:published_time" content="2021-12-28T14:41:24+09:00"><meta property="article:modified_time" content="2021-12-28T14:41:24+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="管理しやすい集計表の作り方"><meta name=twitter:description content="はじめに Excel で集計表を作る時に、管理しやすい作り方を記載する。 今回は例として、従業員の残業時間の一覧表を挙げる。 この表に直接残業時間などを入力しても良いが、Excelのデータは「入力用」「集計用」「表示"><meta name=generator content="Hugo 0.74.1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=https://vicugna-pacos.github.io/css/normalize.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/main.css><link rel=stylesheet href=https://vicugna-pacos.github.io/css/pagination.css><title>管理しやすい集計表の作り方 - アルパカのメモ</title></head><body><header class=header-area><div class=content-container><span class=logo-text><a href=/>アルパカのメモ</a></span></div></header><div class=content-container><nav><ol class=breadcrumbnav><li>Home</li><li>Excel</li></ol></nav></div><main class=main-area><div class="content-container single"><div class=side><aside class=toc><p>目次</p><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#入力用シート>「入力用」シート</a></li><li><a href=#集計用シート>「集計用」シート</a><ul><li><a href=#複数テーブルを集計する>複数テーブルを集計する</a></li></ul></li><li><a href=#表示用シート>「表示用」シート</a></li><li><a href=#集計表を運用する>集計表を運用する</a></li></ul></nav></aside></div><div class=main><article><h1>管理しやすい集計表の作り方</h1><div class=article-info><div><i class=material-icons>calendar_today</i>
<time datetime="2021-12-28 14:41:24 +0900 +0900" itemprop=datePublished>2021-12-28</time></div><div></div></div><h2 id=はじめに>はじめに</h2><p>Excel で集計表を作る時に、管理しやすい作り方を記載する。
今回は例として、従業員の残業時間の一覧表を挙げる。</p><p><img src=2021-12-28-14-49-25.png alt></p><p>この表に直接残業時間などを入力しても良いが、Excelのデータは「入力用」「集計用」「表示用」の3つに分けた方がよい。
この分け方には以下のメリットがある：</p><ul><li>「入力用」はシンプルなデータとして管理するので、他の視点で集計したくなったときに対応しやすい。</li><li>入力作業が簡素化できるので、VBAなどで自動化する際もコーディングしやすくなる。</li></ul><h2 id=入力用シート>「入力用」シート</h2><p>最終的に見せたい表の元ネタとなるデータを管理するシートのこと。</p><p>先ほど挙げたサンプルの表は、名前が縦に並び、年月と残業時間が横に並んでいた。しかし、入力用シートで管理する際は、「年月」という列を追加し月ごとの残業時間を縦に並べる。</p><p><img src=2021-12-28-15-20-03.png alt></p><p>端的に言えば、正規化したテーブルを作成すればよい。</p><p>こうしておけば、月ごとにデータが増えても、新しい行を追加していくだけになる。
年月が横に並んでいる場合、1月はB列、2月はD列など、月ごとに入力するべき列が変わってしまう。手作業であればあまり負担だと感じない作業だが、VBAで自動化しようとすると手間が少しかかる。</p><p>なお、テーブルを作成する手順は下記の通り：</p><ol><li>ヘッダー行とそれに続くデータ行を数行作成し、その範囲を選択する。</li><li>メニューの「挿入」タブ → 「テーブル」をクリック。</li><li>「テーブルの作成」ウィンドウが表示されるので、範囲を確認し、「先頭行を見出しとして使用する」にチェックを入れ、OK をクリックする。</li></ol><p><img src=2021-12-28-15-55-25.png alt></p><p>テーブルに設定された範囲が青い枠線で囲まれる。</p><p>テーブルの次の行にデータを入力すると、自動的にテーブルの範囲が拡張される。手動で範囲を変更したい場合は、右下の青い塊(？)をドラッグする。</p><p><img src=2021-12-28-15-59-40.png alt></p><p>また、テーブルの範囲内のセルを選択すると、メニューに「テーブル デザイン」タブが現れる。
テーブルの色々な設定が変更できるが、中でも「テーブル名」は参照に使うこともあるので、分かりやすい名前を設定しておくとよい。</p><p><img src=2021-12-28-16-09-35.png alt></p><p>テーブルをVBAで扱うには、ListObject などを使う。使い方は <a href=https://vicugna-pacos.github.io/vba/excel/list-object/>別ページ</a> にまとめた。</p><h2 id=集計用シート>「集計用」シート</h2><p>入力用シートで作ったデータはピボットテーブルで集計する。</p><p><img src=2021-12-28-15-29-02.png alt></p><p>今回のサンプルではデータを集計する必要性が薄いが、それでも一度データをピボットテーブルにしておく利点がある (詳しくは「表示用」シートの章で解説)。</p><h3 id=複数テーブルを集計する>複数テーブルを集計する</h3><p>ピボットテーブルにはリレーションを設定したテーブルを結合して集計する機能もある。</p><p>例えば、部門ごとの残業時間集計を求めたい場合、残業時間のテーブルとは別に、従業員ごとの所属部門のテーブルを用意する。</p><p><img src=2021-12-28-15-46-45.png alt></p><p>次に、「データ」タブの「リレーションシップ」をクリックする。</p><p><img src=2021-12-28-15-47-45.png alt></p><p>「リレーションシップの管理」ウィンドウが表示されるので、「新規作成」をクリックする。</p><p><img src=2021-12-28-15-50-13.png alt></p><p>「リレーションシップの作成」ウィンドウが表示されるので、結合する列の主となるテーブルを「関連テーブル」に設定し、従となるテーブルを「テーブル」に設定する (従が上段) 。
今回のサンプルでは、残業時間テーブルが「テーブル」になり、社員情報テーブルが「関連テーブル」になる。</p><p><img src=2021-12-28-16-16-30.png alt></p><p>次に、メニューの「挿入」タブ → 「ピボットテーブル」をクリックする。「ピボットテーブルの作成」ウィンドウが表示されるので、「このブックのデータモデルを使用する」を選択し、OKをクリックする。</p><p><img src=2021-12-28-16-27-24.png alt></p><p>すると、ピボットテーブルに追加できるフィールドに、リレーションシップを設定した2つのテーブルが表示される。</p><p><img src=2021-12-28-16-30-21.png alt></p><p>この状態で、「部門」を行ラベルに設定すると、部門ごとの集計ができる。</p><p><img src=2021-12-28-16-32-04.png alt></p><h2 id=表示用シート>「表示用」シート</h2><p>見た目が整った、人に見せるための表を作る。</p><p>データ部分は GETPIVOTDATA 関数を使い、「集計用」シートから取得する。</p><p><img src=2021-12-28-17-06-49.png alt></p><p>この関数であれば複数のフィールドを条件にして値を取得できるので、VLOOKUP 関数より使い勝手が良いと思う。</p><h2 id=集計表を運用する>集計表を運用する</h2><p>月ごとに残業時間のデータを追加する際は、「入力用」シートにデータを追加し、「集計用」シートのピボットテーブルを更新すればよい。
例えば「表示用」シートの見た目を変更する必要が出てきても、データは残っているので気兼ねなく変更できる。
このようにデータを蓄積し、集計し、報告する必要があるExcelを作る時は、この方法を頭に入れておくと効率の良い運用ができると思う。</p></article></div></div></main><footer class=footer-area><div class=content-container><hr><div class=author-container><div class=avatar><img src=/images/avatar.jpg></div><div class=author><p class=author-name>alpaca</p><p>おおむねSIerにいますが、他業種の社内SEだったこともあります。</p><p><a href=https://github.com/vicugna-pacos><img src=/images/GitHub-Mark-32px.png style=width:2rem></a></p></div></div></div></footer></body></html>